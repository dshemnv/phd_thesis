\documentclass[tikz]{standalone}

\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage{eulervm}
\usepackage{amsmath}
\usepackage{bm}
\usepackage{tikz}
\usepackage{environ}

\usetikzlibrary{fit}
\usetikzlibrary{patterns}
\usetikzlibrary{arrows}

\input{./settings/colors}

\begin{document}
  \begin{tikzpicture}[baseline]
    \tikzset{ cbemp/.style={draw=black, minimum width=0.25cm, minimum height=0.25cm, text=black, fill=white       } }
    \tikzset{ cbue1/.style={draw=black, minimum width=0.25cm, minimum height=0.25cm, text=black, fill=Paired-1!40 } }
    \tikzset{ cbue2/.style={draw=black, minimum width=0.25cm, minimum height=0.25cm, text=black, fill=Paired-3!40 } }
    \tikzset{ cbue3/.style={draw=black, minimum width=0.25cm, minimum height=0.25cm, text=black, fill=Paired-5!40 } }
    \tikzset{ cbue4/.style={draw=black, minimum width=0.25cm, minimum height=0.25cm, text=black, fill=Paired-7!40 } }
    \tikzset{ cbue5/.style={draw=black, minimum width=0.25cm, minimum height=0.25cm, text=black, fill=Paired-9!40 } }
    \tikzset{ cbue6/.style={draw=black, minimum width=0.25cm, minimum height=0.25cm, text=black, fill=Paired-11!40} }
    \tikzset{ cbadd/.style={draw=black, minimum width=0.25cm, minimum height=0.25cm, text=black, fill=black!40    } }

    \newcommand\yshft{2.00}

    \node[cbemp] (ue1_cb_0_0) at (0.00+0.00, \yshft+0.00) {};
    \node[cbemp] (ue1_cb_1_0) at (0.00+0.25, \yshft+0.00) {};
    \node[cbemp] (ue1_cb_2_0) at (0.00+0.50, \yshft+0.00) {};
    \node[cbemp] (ue1_cb_3_0) at (0.00+0.75, \yshft+0.00) {};
    \node[cbemp] (ue1_cb_0_1) at (0.00+0.00, \yshft+0.25) {};
    \node[cbemp] (ue1_cb_1_1) at (0.00+0.25, \yshft+0.25) {};
    \node[cbemp] (ue1_cb_2_1) at (0.00+0.50, \yshft+0.25) {};
    \node[cbemp] (ue1_cb_3_1) at (0.00+0.75, \yshft+0.25) {};
    \node[cbue1] (ue1_cb_0_2) at (0.00+0.00, \yshft+0.50) {};
    \node[cbue1] (ue1_cb_1_2) at (0.00+0.25, \yshft+0.50) {};
    \node[cbue1] (ue1_cb_2_2) at (0.00+0.50, \yshft+0.50) {};
    \node[cbue1] (ue1_cb_3_2) at (0.00+0.75, \yshft+0.50) {};
    \node[cbue1] (ue1_cb_0_3) at (0.00+0.00, \yshft+0.75) {};
    \node[cbue1] (ue1_cb_1_3) at (0.00+0.25, \yshft+0.75) {};
    \node[cbue1] (ue1_cb_2_3) at (0.00+0.50, \yshft+0.75) {};
    \node[cbue1] (ue1_cb_3_3) at (0.00+0.75, \yshft+0.75) {};

    \node[cbue2] (ue2_cb_0_0) at (1.50+0.00, \yshft+0.00) {};
    \node[cbue2] (ue2_cb_1_0) at (1.50+0.25, \yshft+0.00) {};
    \node[cbue2] (ue2_cb_2_0) at (1.50+0.50, \yshft+0.00) {};
    \node[cbue2] (ue2_cb_3_0) at (1.50+0.75, \yshft+0.00) {};
    \node[cbue2] (ue2_cb_0_1) at (1.50+0.00, \yshft+0.25) {};
    \node[cbue2] (ue2_cb_1_1) at (1.50+0.25, \yshft+0.25) {};
    \node[cbue2] (ue2_cb_2_1) at (1.50+0.50, \yshft+0.25) {};
    \node[cbue2] (ue2_cb_3_1) at (1.50+0.75, \yshft+0.25) {};
    \node[cbemp] (ue2_cb_0_2) at (1.50+0.00, \yshft+0.50) {};
    \node[cbemp] (ue2_cb_1_2) at (1.50+0.25, \yshft+0.50) {};
    \node[cbemp] (ue2_cb_2_2) at (1.50+0.50, \yshft+0.50) {};
    \node[cbemp] (ue2_cb_3_2) at (1.50+0.75, \yshft+0.50) {};
    \node[cbemp] (ue2_cb_0_3) at (1.50+0.00, \yshft+0.75) {};
    \node[cbemp] (ue2_cb_1_3) at (1.50+0.25, \yshft+0.75) {};
    \node[cbemp] (ue2_cb_2_3) at (1.50+0.50, \yshft+0.75) {};
    \node[cbemp] (ue2_cb_3_3) at (1.50+0.75, \yshft+0.75) {};

    \node[cbemp] (ue3_cb_0_0) at (3.00+0.00, \yshft+0.00) {};
    \node[cbemp] (ue3_cb_1_0) at (3.00+0.25, \yshft+0.00) {};
    \node[cbemp] (ue3_cb_2_0) at (3.00+0.50, \yshft+0.00) {};
    \node[cbemp] (ue3_cb_3_0) at (3.00+0.75, \yshft+0.00) {};
    \node[cbue3] (ue3_cb_0_1) at (3.00+0.00, \yshft+0.25) {};
    \node[cbue3] (ue3_cb_1_1) at (3.00+0.25, \yshft+0.25) {};
    \node[cbue3] (ue3_cb_2_1) at (3.00+0.50, \yshft+0.25) {};
    \node[cbue3] (ue3_cb_3_1) at (3.00+0.75, \yshft+0.25) {};
    \node[cbemp] (ue3_cb_0_2) at (3.00+0.00, \yshft+0.50) {};
    \node[cbemp] (ue3_cb_1_2) at (3.00+0.25, \yshft+0.50) {};
    \node[cbemp] (ue3_cb_2_2) at (3.00+0.50, \yshft+0.50) {};
    \node[cbemp] (ue3_cb_3_2) at (3.00+0.75, \yshft+0.50) {};
    \node[cbue3] (ue3_cb_0_3) at (3.00+0.00, \yshft+0.75) {};
    \node[cbue3] (ue3_cb_1_3) at (3.00+0.25, \yshft+0.75) {};
    \node[cbue3] (ue3_cb_2_3) at (3.00+0.50, \yshft+0.75) {};
    \node[cbue3] (ue3_cb_3_3) at (3.00+0.75, \yshft+0.75) {};

    \node[cbue4] (ue4_cb_0_0) at (4.50+0.00, \yshft+0.00) {};
    \node[cbue4] (ue4_cb_1_0) at (4.50+0.25, \yshft+0.00) {};
    \node[cbue4] (ue4_cb_2_0) at (4.50+0.50, \yshft+0.00) {};
    \node[cbue4] (ue4_cb_3_0) at (4.50+0.75, \yshft+0.00) {};
    \node[cbemp] (ue4_cb_0_1) at (4.50+0.00, \yshft+0.25) {};
    \node[cbemp] (ue4_cb_1_1) at (4.50+0.25, \yshft+0.25) {};
    \node[cbemp] (ue4_cb_2_1) at (4.50+0.50, \yshft+0.25) {};
    \node[cbemp] (ue4_cb_3_1) at (4.50+0.75, \yshft+0.25) {};
    \node[cbue4] (ue4_cb_0_2) at (4.50+0.00, \yshft+0.50) {};
    \node[cbue4] (ue4_cb_1_2) at (4.50+0.25, \yshft+0.50) {};
    \node[cbue4] (ue4_cb_2_2) at (4.50+0.50, \yshft+0.50) {};
    \node[cbue4] (ue4_cb_3_2) at (4.50+0.75, \yshft+0.50) {};
    \node[cbemp] (ue4_cb_0_3) at (4.50+0.00, \yshft+0.75) {};
    \node[cbemp] (ue4_cb_1_3) at (4.50+0.25, \yshft+0.75) {};
    \node[cbemp] (ue4_cb_2_3) at (4.50+0.50, \yshft+0.75) {};
    \node[cbemp] (ue4_cb_3_3) at (4.50+0.75, \yshft+0.75) {};

    \node[cbue5] (ue5_cb_0_0) at (6.00+0.00, \yshft+0.00) {};
    \node[cbue5] (ue5_cb_1_0) at (6.00+0.25, \yshft+0.00) {};
    \node[cbue5] (ue5_cb_2_0) at (6.00+0.50, \yshft+0.00) {};
    \node[cbue5] (ue5_cb_3_0) at (6.00+0.75, \yshft+0.00) {};
    \node[cbemp] (ue5_cb_0_1) at (6.00+0.00, \yshft+0.25) {};
    \node[cbemp] (ue5_cb_1_1) at (6.00+0.25, \yshft+0.25) {};
    \node[cbemp] (ue5_cb_2_1) at (6.00+0.50, \yshft+0.25) {};
    \node[cbemp] (ue5_cb_3_1) at (6.00+0.75, \yshft+0.25) {};
    \node[cbemp] (ue5_cb_0_2) at (6.00+0.00, \yshft+0.50) {};
    \node[cbemp] (ue5_cb_1_2) at (6.00+0.25, \yshft+0.50) {};
    \node[cbemp] (ue5_cb_2_2) at (6.00+0.50, \yshft+0.50) {};
    \node[cbemp] (ue5_cb_3_2) at (6.00+0.75, \yshft+0.50) {};
    \node[cbue5] (ue5_cb_0_3) at (6.00+0.00, \yshft+0.75) {};
    \node[cbue5] (ue5_cb_1_3) at (6.00+0.25, \yshft+0.75) {};
    \node[cbue5] (ue5_cb_2_3) at (6.00+0.50, \yshft+0.75) {};
    \node[cbue5] (ue5_cb_3_3) at (6.00+0.75, \yshft+0.75) {};

    \node[cbemp] (ue6_cb_0_0) at (7.50+0.00, \yshft+0.00) {};
    \node[cbemp] (ue6_cb_1_0) at (7.50+0.25, \yshft+0.00) {};
    \node[cbemp] (ue6_cb_2_0) at (7.50+0.50, \yshft+0.00) {};
    \node[cbemp] (ue6_cb_3_0) at (7.50+0.75, \yshft+0.00) {};
    \node[cbue6] (ue6_cb_0_1) at (7.50+0.00, \yshft+0.25) {};
    \node[cbue6] (ue6_cb_1_1) at (7.50+0.25, \yshft+0.25) {};
    \node[cbue6] (ue6_cb_2_1) at (7.50+0.50, \yshft+0.25) {};
    \node[cbue6] (ue6_cb_3_1) at (7.50+0.75, \yshft+0.25) {};
    \node[cbue6] (ue6_cb_0_2) at (7.50+0.00, \yshft+0.50) {};
    \node[cbue6] (ue6_cb_1_2) at (7.50+0.25, \yshft+0.50) {};
    \node[cbue6] (ue6_cb_2_2) at (7.50+0.50, \yshft+0.50) {};
    \node[cbue6] (ue6_cb_3_2) at (7.50+0.75, \yshft+0.50) {};
    \node[cbemp] (ue6_cb_0_3) at (7.50+0.00, \yshft+0.75) {};
    \node[cbemp] (ue6_cb_1_3) at (7.50+0.25, \yshft+0.75) {};
    \node[cbemp] (ue6_cb_2_3) at (7.50+0.50, \yshft+0.75) {};
    \node[cbemp] (ue6_cb_3_3) at (7.50+0.75, \yshft+0.75) {};

    \newcommand\xshft{1.875}

    \node[cbemp] (ue1_cb_0) at (\xshft+0.00+0.00, 0.00+0.00) {};
    \node[cbemp] (ue1_cb_1) at (\xshft+0.00+0.00, 0.00+0.25) {};
    \node[cbue1] (ue1_cb_2) at (\xshft+0.00+0.00, 0.00+0.50) {};
    \node[cbue1] (ue1_cb_3) at (\xshft+0.00+0.00, 0.00+0.75) {};

    \node[text width=0.2cm] (p1) at (\xshft+0.00+0.325, 0.00+0.375) {\small{$+$}};

    \node[cbue2] (ue2_cb_0) at (\xshft+0.75+0.00, 0.00+0.00) {};
    \node[cbue2] (ue2_cb_1) at (\xshft+0.75+0.00, 0.00+0.25) {};
    \node[cbemp] (ue2_cb_2) at (\xshft+0.75+0.00, 0.00+0.50) {};
    \node[cbemp] (ue2_cb_3) at (\xshft+0.75+0.00, 0.00+0.75) {};

    \node[text width=0.2cm] (p2) at (\xshft+0.75+0.325, 0.00+0.375) {\small{$+$}};

    \node[cbemp] (ue3_cb_0) at (\xshft+1.50+0.00, 0.00+0.00) {};
    \node[cbue3] (ue3_cb_1) at (\xshft+1.50+0.00, 0.00+0.25) {};
    \node[cbemp] (ue3_cb_2) at (\xshft+1.50+0.00, 0.00+0.50) {};
    \node[cbue3] (ue3_cb_3) at (\xshft+1.50+0.00, 0.00+0.75) {};

    \node[text width=0.2cm] (p3) at (\xshft+1.50+0.325, 0.00+0.375) {\small{$+$}};

    \node[cbue4] (ue4_cb_0) at (\xshft+2.25+0.00, 0.00+0.00) {};
    \node[cbemp] (ue4_cb_1) at (\xshft+2.25+0.00, 0.00+0.25) {};
    \node[cbue4] (ue4_cb_2) at (\xshft+2.25+0.00, 0.00+0.50) {};
    \node[cbemp] (ue4_cb_3) at (\xshft+2.25+0.00, 0.00+0.75) {};

    \node[text width=0.2cm] (p4) at (\xshft+2.25+0.325, 0.00+0.375) {\small{$+$}};

    \node[cbue5] (ue5_cb_0) at (\xshft+3.00+0.00, 0.00+0.00) {};
    \node[cbemp] (ue5_cb_1) at (\xshft+3.00+0.00, 0.00+0.25) {};
    \node[cbemp] (ue5_cb_2) at (\xshft+3.00+0.00, 0.00+0.50) {};
    \node[cbue5] (ue5_cb_3) at (\xshft+3.00+0.00, 0.00+0.75) {};

    \node[text width=0.2cm] (p5) at (\xshft+3.00+0.325, 0.00+0.375) {\small{$+$}};

    \node[cbemp] (ue6_cb_0) at (\xshft+3.75+0.00, 0.00+0.00) {};
    \node[cbue6] (ue6_cb_1) at (\xshft+3.75+0.00, 0.00+0.25) {};
    \node[cbue6] (ue6_cb_2) at (\xshft+3.75+0.00, 0.00+0.50) {};
    \node[cbemp] (ue6_cb_3) at (\xshft+3.75+0.00, 0.00+0.75) {};

    \node[text width=0.2cm] (a1) at (\xshft+3.75+0.325, 0.00+0.375) {\small{$\rightarrow$}};

    \node[cbadd] (uea_cb_0) at (\xshft+4.50+0.00, 0.00+0.00) {};
    \node[cbadd] (uea_cb_1) at (\xshft+4.50+0.00, 0.00+0.25) {};
    \node[cbadd] (uea_cb_2) at (\xshft+4.50+0.00, 0.00+0.50) {};
    \node[cbadd] (uea_cb_3) at (\xshft+4.50+0.00, 0.00+0.75) {};

    \draw[->,>=latex] (ue1_cb_1_0.south east) -- (ue1_cb_3.north) node [midway, fill=white] {\tiny{$\bm{h}_1$}};
    \draw[->,>=latex] (ue2_cb_1_0.south east) -- (ue2_cb_3.north) node [midway, fill=white] {\tiny{$\bm{h}_2$}};
    \draw[->,>=latex] (ue3_cb_1_0.south east) -- (ue3_cb_3.north) node [midway, fill=white] {\tiny{$\bm{h}_3$}};
    \draw[->,>=latex] (ue4_cb_1_0.south east) -- (ue4_cb_3.north) node [midway, fill=white] {\tiny{$\bm{h}_4$}};
    \draw[->,>=latex] (ue5_cb_1_0.south east) -- (ue5_cb_3.north) node [midway, fill=white] {\tiny{$\bm{h}_5$}};
    \draw[->,>=latex] (ue6_cb_1_0.south east) -- (ue6_cb_3.north) node [midway, fill=white] {\tiny{$\bm{h}_6$}};

    \node[text width=1.5cm, align=center] (t1) at (\xshft-1.0, 0.00+0.50) {\tiny{Users chosen}};
    \node[text width=1.5cm, align=center] (t2) at (\xshft-1.0, 0.00+0.25) {\tiny{codewords}};

    \node[text width=1.5cm, align=center] (t3) at (0.00+0.375, \yshft+1.00) {\tiny{$UE1$ CB}};
    \node[text width=1.5cm, align=center] (t4) at (1.50+0.375, \yshft+1.00) {\tiny{$UE2$ CB}};
    \node[text width=1.5cm, align=center] (t5) at (3.00+0.375, \yshft+1.00) {\tiny{$UE3$ CB}};
    \node[text width=1.5cm, align=center] (t6) at (4.50+0.375, \yshft+1.00) {\tiny{$UE4$ CB}};
    \node[text width=1.5cm, align=center] (t7) at (6.00+0.375, \yshft+1.00) {\tiny{$UE5$ CB}};
    \node[text width=1.5cm, align=center] (t8) at (7.50+0.375, \yshft+1.00) {\tiny{$UE6$ CB}};

    \node[draw=Paired-1, rounded corners=2pt, minimum height=2cm, dashed, fit=(t3) (ue1_cb_0_3) (t8) (ue6_cb_3_3) (ue1_cb_0)] {};

  \end{tikzpicture}
\end{document}