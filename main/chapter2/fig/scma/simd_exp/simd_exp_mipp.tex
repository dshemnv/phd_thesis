\documentclass{standalone}

\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage{eulervm}
\usepackage{amsmath}
\usepackage{bm}
\usepackage{tikz}
\usepackage{environ}

\usetikzlibrary{fit}
\usetikzlibrary{patterns}
\usetikzlibrary{arrows}

\input{colors}

\begin{document}
  \begin{tikzpicture}[baseline]
    \tikzset{ e/.style  ={draw=black, minimum width=0.7cm, minimum height=0.7cm, text=black, fill=gray!40             } }
    \tikzset{ en/.style ={draw=black, minimum width=0.7cm, minimum height=0.7cm, text=black, fill=Paired-5!40         } }
    \tikzset{ ens/.style={draw=black, minimum width=0.7cm, minimum height=0.7cm, text=black, fill=Paired-6!40         } }
    \tikzset{ enn/.style={draw=black, minimum width=0.7cm, minimum height=0.7cm, text=black, fill=gray!40!Paired-5!40 } }
    \tikzset{ ep/.style ={draw=black, minimum width=0.7cm, minimum height=0.7cm, text=black, fill=Paired-7!40         } }
    \tikzset{ eps/.style={draw=black, minimum width=0.7cm, minimum height=0.7cm, text=black, fill=Paired-8!40         } }
    \tikzset{ ept/.style={            minimum width=0.7cm, minimum height=0.7cm] } }

    \tikzstyle{lnk}=[->,>=stealth,rounded corners=3pt]
    \tikzstyle{shf}=[black!20]
    \tikzstyle{instr}=[->,>=stealth,rounded corners=3pt, fill=white, draw=black]

    \newcommand\vs{2.0}
    \newcommand\lft{0.0}
    \newcommand\ctr{4.9}
    \newcommand\rth{9.8}

    \node[draw=black, dotted                     , minimum width=0.8cm, minimum height=0.4cm, label={[black]right:\footnotesize{memory}}       ] (ram)   at (0.1, -1.1-3) {};
    \node[draw=black,                            , minimum width=0.8cm, minimum height=0.4cm, label={[black]right:\footnotesize{SIMD register}}] (simdr) at (0.1, -1.7-3) {};
    \node[draw=black,         rounded corners=3pt, minimum width=0.8cm, minimum height=0.4cm, label={[black]right:\footnotesize{SIMD function}}] (simdi) at (0.1, -2.3-3) {};

    \node[fill=Paired-5!40, minimum width=0.8cm, minimum height=0.4cm, label={[black]left:\footnotesize{Complex norm $d_x$}}] (cn) at (\rth+0.7+4.10, -1.1-3) {};
    \node[fill=gray!40    , minimum width=0.8cm, minimum height=0.4cm, label={[black]left:\footnotesize{Noise $n_x = -N_0$}}] (n0) at (\rth+0.7+4.10, -1.7-3) {};
    \node[fill=Paired-7!40, minimum width=0.8cm, minimum height=0.4cm, label={[black]left:\footnotesize{Probability $P_x$}} ] (p)  at (\rth+0.7+4.10, -2.3-3) {};

    \node[ept        ] (mi_e0)  at ( 0.0, 0.00) {\tiny{...}};
    \node[ens, dotted] (mi_e1)  at ( 0.7, 0.00) {};
    \node[ens, dotted] (mi_e2)  at ( 1.4, 0.00) {};
    \node[ens, dotted] (mi_e3)  at ( 2.1, 0.00) {};
    \node[ens, dotted] (mi_e4)  at ( 2.8, 0.00) {};
    \node[ens, dotted] (mi_e5)  at ( 3.5, 0.00) {};
    \node[ens, dotted] (mi_e6)  at ( 4.2, 0.00) {};
    \node[en , dotted] (mi_e7)  at ( 4.9, 0.00) {};
    \node[en , dotted] (mi_e8)  at ( 5.6, 0.00) {};
    \node[en , dotted] (mi_e9)  at ( 6.3, 0.00) {};
    \node[en , dotted] (mi_e10) at ( 7.0, 0.00) {};
    \node[en , dotted] (mi_e11) at ( 7.7, 0.00) {};
    \node[en , dotted] (mi_e12) at ( 8.4, 0.00) {};
    \node[en , dotted] (mi_e13) at ( 9.1, 0.00) {};
    \node[en , dotted] (mi_e14) at ( 9.8, 0.00) {};
    \node[ens, dotted] (mi_e15) at (10.5, 0.00) {};
    \node[ens, dotted] (mi_e16) at (11.2, 0.00) {};
    \node[ens, dotted] (mi_e17) at (11.9, 0.00) {};
    \node[ens, dotted] (mi_e18) at (12.6, 0.00) {};
    \node[ens, dotted] (mi_e19) at (13.3, 0.00) {};
    \node[ens, dotted] (mi_e20) at (14.0, 0.00) {};
    \node[ept        ] (mi_e21) at (14.7, 0.00) {\tiny{...}};

    \node[en] (r0_e0) at (\lft+0.0, -\vs) {\tiny{$d_1$}};
    \node[en] (r0_e1) at (\lft+0.7, -\vs) {\tiny{$d_2$}};
    \node[en] (r0_e2) at (\lft+1.4, -\vs) {\tiny{$d_3$}};
    \node[en] (r0_e3) at (\lft+2.1, -\vs) {\tiny{$d_4$}};
    \node[en] (r0_e4) at (\lft+2.8, -\vs) {\tiny{$d_5$}};
    \node[en] (r0_e5) at (\lft+3.5, -\vs) {\tiny{$d_6$}};
    \node[en] (r0_e6) at (\lft+4.2, -\vs) {\tiny{$d_7$}};
    \node[en] (r0_e7) at (\lft+4.9, -\vs) {\tiny{$d_8$}};

    \node[instr] (instr0) at (\lft+2.45, -\vs+1) {\footnotesize{\texttt{mipp::load<T>}}};
    \draw[lnk] (7.35,-0.35) |- (instr0.east);
    \draw[lnk] (instr0.south) -- (2.45,-\vs+0.35);

    \node[e] (r1_e0) at (\rth+0.0, -\vs) {\tiny{$n_1$}};
    \node[e] (r1_e1) at (\rth+0.7, -\vs) {\tiny{$n_2$}};
    \node[e] (r1_e2) at (\rth+1.4, -\vs) {\tiny{$n_3$}};
    \node[e] (r1_e3) at (\rth+2.1, -\vs) {\tiny{$n_4$}};
    \node[e] (r1_e4) at (\rth+2.8, -\vs) {\tiny{$n_5$}};
    \node[e] (r1_e5) at (\rth+3.5, -\vs) {\tiny{$n_6$}};
    \node[e] (r1_e6) at (\rth+4.2, -\vs) {\tiny{$n_7$}};
    \node[e] (r1_e7) at (\rth+4.9, -\vs) {\tiny{$n_8$}};

    \node[instr] (instr1) at (\rth+2.45, -\vs+1) {\footnotesize{\texttt{mipp::set1<T>(}$-N_0$\texttt{)}}};
    \draw[lnk] (instr1.south) -- (\rth+2.45,-\vs+0.35);

    \node[enn] (r2_e0) at (\ctr+0.0, -\vs-\vs) {\tiny{$\hat{d_1}$}};
    \node[enn] (r2_e1) at (\ctr+0.7, -\vs-\vs) {\tiny{$\hat{d_2}$}};
    \node[enn] (r2_e2) at (\ctr+1.4, -\vs-\vs) {\tiny{$\hat{d_3}$}};
    \node[enn] (r2_e3) at (\ctr+2.1, -\vs-\vs) {\tiny{$\hat{d_4}$}};
    \node[enn] (r2_e4) at (\ctr+2.8, -\vs-\vs) {\tiny{$\hat{d_5}$}};
    \node[enn] (r2_e5) at (\ctr+3.5, -\vs-\vs) {\tiny{$\hat{d_6}$}};
    \node[enn] (r2_e6) at (\ctr+4.2, -\vs-\vs) {\tiny{$\hat{d_7}$}};
    \node[enn] (r2_e7) at (\ctr+4.9, -\vs-\vs) {\tiny{$\hat{d_8}$}};

    \draw[shf] (r0_e0.south) -- (r2_e0.north);
    \draw[shf] (r0_e1.south) -- (r2_e1.north);
    \draw[shf] (r0_e2.south) -- (r2_e2.north);
    \draw[shf] (r0_e3.south) -- (r2_e3.north);
    \draw[shf] (r0_e4.south) -- (r2_e4.north);
    \draw[shf] (r0_e5.south) -- (r2_e5.north);
    \draw[shf] (r0_e6.south) -- (r2_e6.north);
    \draw[shf] (r0_e7.south) -- (r2_e7.north);
    \draw[shf] (r1_e0.south) -- (r2_e0.north);
    \draw[shf] (r1_e1.south) -- (r2_e1.north);
    \draw[shf] (r1_e2.south) -- (r2_e2.north);
    \draw[shf] (r1_e3.south) -- (r2_e3.north);
    \draw[shf] (r1_e4.south) -- (r2_e4.north);
    \draw[shf] (r1_e5.south) -- (r2_e5.north);
    \draw[shf] (r1_e6.south) -- (r2_e6.north);
    \draw[shf] (r1_e7.south) -- (r2_e7.north);

    \node[instr] (instr2) at (\ctr+2.45, -\vs-\vs+1) {\footnotesize{\texttt{mipp::div<T>}}};

    \draw[lnk] (r0_e4.south west) |- (instr2.west);
    \draw[lnk] (r1_e3.south east) |- (instr2.east);
    \draw[lnk] (instr2.south)      -- (7.35,-\vs-\vs+0.35);

    \node[ep] (r3_e0) at (\ctr+0.0, -\vs-\vs-\vs) {\tiny{$P_1$}};
    \node[ep] (r3_e1) at (\ctr+0.7, -\vs-\vs-\vs) {\tiny{$P_2$}};
    \node[ep] (r3_e2) at (\ctr+1.4, -\vs-\vs-\vs) {\tiny{$P_3$}};
    \node[ep] (r3_e3) at (\ctr+2.1, -\vs-\vs-\vs) {\tiny{$P_4$}};
    \node[ep] (r3_e4) at (\ctr+2.8, -\vs-\vs-\vs) {\tiny{$P_5$}};
    \node[ep] (r3_e5) at (\ctr+3.5, -\vs-\vs-\vs) {\tiny{$P_6$}};
    \node[ep] (r3_e6) at (\ctr+4.2, -\vs-\vs-\vs) {\tiny{$P_7$}};
    \node[ep] (r3_e7) at (\ctr+4.9, -\vs-\vs-\vs) {\tiny{$P_8$}};

    \node[instr] (instr3) at (\ctr+2.45, -\vs-\vs-\vs+1) {\footnotesize{\texttt{mipp::exp<T>}}};

    \draw[lnk] (7.35, -\vs-\vs-0.35) -- (instr3);
    \draw[lnk] (instr3) -- (7.35,-\vs-\vs-\vs+0.35);

    \node[ept        ] (mo_er0)  at ( 0.0, -\vs-\vs-\vs-\vs-0.00) {\tiny{...}};
    \node[eps, dotted] (mo_er1)  at ( 0.7, -\vs-\vs-\vs-\vs-0.00) {};
    \node[eps, dotted] (mo_er2)  at ( 1.4, -\vs-\vs-\vs-\vs-0.00) {};
    \node[eps, dotted] (mo_er3)  at ( 2.1, -\vs-\vs-\vs-\vs-0.00) {};
    \node[eps, dotted] (mo_er4)  at ( 2.8, -\vs-\vs-\vs-\vs-0.00) {};
    \node[eps, dotted] (mo_er5)  at ( 3.5, -\vs-\vs-\vs-\vs-0.00) {};
    \node[eps, dotted] (mo_er6)  at ( 4.2, -\vs-\vs-\vs-\vs-0.00) {};
    \node[ep , dotted] (mo_er7)  at ( 4.9, -\vs-\vs-\vs-\vs-0.00) {};
    \node[ep , dotted] (mo_er8)  at ( 5.6, -\vs-\vs-\vs-\vs-0.00) {};
    \node[ep , dotted] (mo_er9)  at ( 6.3, -\vs-\vs-\vs-\vs-0.00) {};
    \node[ep , dotted] (mo_er10) at ( 7.0, -\vs-\vs-\vs-\vs-0.00) {};
    \node[ep , dotted] (mo_er11) at ( 7.7, -\vs-\vs-\vs-\vs-0.00) {};
    \node[ep , dotted] (mo_er12) at ( 8.4, -\vs-\vs-\vs-\vs-0.00) {};
    \node[ep , dotted] (mo_er13) at ( 9.1, -\vs-\vs-\vs-\vs-0.00) {};
    \node[ep , dotted] (mo_er14) at ( 9.8, -\vs-\vs-\vs-\vs-0.00) {};
    \node[eps, dotted] (mo_er15) at (10.5, -\vs-\vs-\vs-\vs-0.00) {};
    \node[eps, dotted] (mo_er16) at (11.2, -\vs-\vs-\vs-\vs-0.00) {};
    \node[eps, dotted] (mo_er17) at (11.9, -\vs-\vs-\vs-\vs-0.00) {};
    \node[eps, dotted] (mo_er18) at (12.6, -\vs-\vs-\vs-\vs-0.00) {};
    \node[eps, dotted] (mo_er19) at (13.3, -\vs-\vs-\vs-\vs-0.00) {};
    \node[eps, dotted] (mo_er20) at (14.0, -\vs-\vs-\vs-\vs-0.00) {};
    \node[ept        ] (mo_er21) at (14.7, -\vs-\vs-\vs-\vs-0.00) {\tiny{...}};

    \node[instr] (instr4) at (\ctr+2.45, -\vs-\vs-\vs-\vs+1) {\footnotesize{\texttt{mipp::store<T>}}};

    \draw[lnk] (7.35, -\vs-\vs-\vs-0.35) -- (instr4);
    \draw[lnk] (instr4) -- (7.35,-\vs-\vs-\vs-\vs+0.35);

    \node[draw=black, rounded corners=2pt, dashed, fit=(mi_e0) (mo_er21)] {};
  \end{tikzpicture}
\end{document}